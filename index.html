<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>API</title>
    <link href="https://cdn.bootcss.com/pure/1.0.1/pure-min.css" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>.button-warning {
            color: white;
            background: rgb(223, 117, 20);
        }
        table {
            width: 100%;
        }
    </style>
</head>
<body>
<input id="addInput" size="50" placeholder="RTSP地址">
<button onclick="add()">添加</button>

<table class="pure-table  pure-table-horizontal pure-table-bordered" >
    <thead>
    <tr>
        <td> #</td>
        <td>流地址</td>
        <td> 操作</td>
    </tr>
    </thead>
    <tbody>

    </tbody>

</table>

<ol id="list-box"></ol>


<script>
    window.onload = function () {
        getList();
    }

    function render(list) {
        if(list == 'null') {
            return
        }
        list = list ? JSON.parse(list) : []

        var html = [];
        for (var i = 0; i < list.length; i++) {
            var tr = "<tr><td>{index}</td><td>{rtsp}<br>{rtmp}<br>{httpFlv}<br>{hls}</td><td><button class='pure-button button-warning'  onclick='remove(\"{rtsp}\")'>删除</button></td></tr>"

            var info = list[i];
            for (var k in info) {
                tr = tr.replace('{' + k + '}', info[k])
            }

            tr = tr.replace("{index}", i + 1);
            tr = tr.replace("{rtsp}", info.rtsp);

            html.push(tr)
        }
        var box = document.getElementsByTagName('tbody')[0]
        box.innerHTML = html.join('');
    }

    function getList() {
        get('/list', render)
    }

    function remove(rtsp) {
        get('/remove?rtsp=' + rtsp, getList)
    }

    function add() {
        var rtsp = document.getElementById('addInput').value;
        get('/add?rtsp=' + rtsp, getList)
    }


    function get(url, callback) {
        var xmlhttp;
        if (window.XMLHttpRequest) {// code for IE7+, Firefox, Chrome, Opera, Safari
            xmlhttp = new XMLHttpRequest();
        } else {// code for IE6, IE5
            xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
        }
        xmlhttp.onreadystatechange = function () {
            if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                callback(xmlhttp.responseText);
            }
        }
        xmlhttp.open("GET", url, true);
        xmlhttp.send();
    }


</script>
</body>
</html>