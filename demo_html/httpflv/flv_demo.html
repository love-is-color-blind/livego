<!DOCTYPE html>
<html>

<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <title>flv.js demo</title>
</head>

<body>

<script src="flv.js"></script>
<video id="videoElement" muted autoplay></video>
<script>

    var stopCount = 0;

    if (flvjs.isSupported()) {
        var video = document.getElementById('videoElement');

        var player = flvjs.createPlayer({
            type: 'flv',
            isLive: true,
            hasAudio: false,
            url: 'http://127.0.0.1:7001/live/rtspadmin1234558161001705122h264ch1subavstream.flv'
        }, {
            enableWorker: true, // 浏览器端开启flv.js的Worker，多线程运行flv.js提升解析速度可以优化延迟
            enableStashBuffer: false, //减少音视频服务器的buffer可以优化延迟，坏处是音视频服务器处理效率降低。
        });
        player.attachMediaElement(video);
        player.load();
        player.play()


        // 一下代码用于错误重试
        function retry() {
            player.unload();
            player.load();
            player.play();
        }

        player.on(flvjs.Events.ERROR, function (e) {
            console.log("global error,retry after 3 seconds", e)
            setTimeout(retry, 3000)
        })
        player.on(flvjs.Events.LOADING_COMPLETE, function (e) {
            console.log("LOADING_COMPLETE", e)
            setTimeout(retry, 3000)
        })
        player.on(flvjs.Events.STATISTICS_INFO, function (e) {
            if (e.speed == 0) {
                if ((++stopCount) >= 5) {
                    stopCount = 0;
                    retry();
                }
            }
        })
        window.player = player;
    }
</script>

</body>

</html>